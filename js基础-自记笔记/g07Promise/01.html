<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>01准备_函数对象与实例对象</title>
    </head>
    <body>
        <script>
            /*
             * 函数对象与实例对象
             * 1.将函数作为对象使用时,简称函数对象
             * 2.new 函数产生的对象,简称为实例对象
             *
             */
            // function Fn() {} //Fn函数
            // const fn = new Fn(); //Fn是构造函数,fn是实例对象
            // console.log(Fn.prototype); //Fn函数对象
            // Fn.bind({}); //Fn函数对象
            // $('#test');//jQuery函数
            // $.get('/test');//jQuery函数对象
            // function Person(params) {}

            //1.同步回调函数
            /* const arr = [1, 3, 5];
                                              arr.forEach((item) => {
                                                  //遍历回调
                                                  console.log(item);
                                              });
                                              console.log('forEach()之后'); */
            // 1
            // 3
            // 5
            // forEach()之后

            //2.同步回调函数
            /* setTimeout(() => {
                                                  //同步回调函数,会放入队列中将来执行
                                                  console.log('timout callback()');
                                              }, 0);
                                              console.log('setTimeout()之后');
                                              //setTimeout()之后
                                              //timout callback() */

            /*  try {
                                         let d;
                                         console.log(d.xxx);
                                     } catch (error) {
                                         console.log(error);
                                         console.log(error.message);
                                         console.log(error.stack);
                                     }
                                     console.log('出错之后'); */

            // function something() {
            //     if (Date.now() % 2 === 1) {
            //         console.log('当前时间为奇数,可以执行任务');
            //     } else {
            //         throw new Error('当前时间为偶数,不可以执行任务');
            //     }
            // }
            // try {
            //     something();
            // } catch (error) {
            //     console.log(error.message);
            // }

            //基本使用
            //1.创建
            /* const p = new Promise((resolve, reject) => {
                //执行器函数
                //2.执行异步操作任务
                setTimeout(() => {
                    const time = Date.now(); //如果当前时间为偶数代表成功,否则失败
                    //3.1如果成功 调用 resolve(value)
                    if (time % 2 === 0) {
                        resolve('成功数据,time=' + time);
                    } else {
                        //3.2如果失败 调用 reject(reason)
                        reject('失败数据,time=' + time);
                    }
                }, 1000);
            });
            p.then(
                (value) => {
                    //接收得到成功的value数据 (onResolved)
                    console.log('成功的回调', value);
                },
                (reason) => {
                    //接收得到失败的reason数据 (onRejected)
                    console.log('失败的回调', reason);
                }
            );

            const promise = createAudioFileAsyns(audioSettings); //2
            setTimeout(() => {
                promise.then(successCallback, failureCallback);
            }, 3000);
            //成功的回调函数
            function successCallback(result) {
                console.log('声音文件创建成功' + result);
            }
            //失败的回调函数
            function failereCallback(error) {
                console.log('声音文件创建成功' + error);
            }

            async function request() {
                try {
                    const result = await doSomething();
                    const newResult = await doSomethingElse(result);
                    const finalResult = await doSomethingElse(newResult);
                    console.log('got the final frsult:' + finalResult);
                } catch (error) {
                    failereCallback(error);
                }
            } */

            /*        new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve('成功的数据');
                    //reject('失败的数据')
                }, 1000);
            })
                .then((value) => {
                    console.log('onResolved()1', value);
                })
                .catch((reason) => {
                    console.log('onReject()1', reason);
                }); */

            //语法

            //     //产生一个成功值为1的promise对象
            //     const p1 = new Promise((resolve, reject) => {
            //         resolve(1);
            //     });
            //     const p2 = Promise.resolve(2);
            //     const p3 = Promise.reject(3);
            //     p1.then((value) => {
            //         console.log(value);
            //     });
            //     p2.then((value) => {
            //         console.log(value);
            //     });
            //     // p3.then((value) => {
            //     //     null,
            //     //         (reason) => {
            //     //             console.log(reason);
            //     //         };
            //     // });
            //     p3.catch((reason) => {
            //         console.log(reason);
            //     });

            //     // const pAll = Promise.all([p1, p2, p3]);
            //    /*  const pAll = Promise.all([p1, p2]);
            //     pAll.then(
            //         (values) => {
            //             console.log('all onResolved()', values);
            //         },
            //         (reason) => {
            //             console.log('all onRejected()', reason);
            //         }
            //     ); */

            //     const pRace = Promise.race([p1, p2, p3]);
            //     pRace.then(
            //         (value) => {
            //             console.log('all onResolved()', value);
            //         },
            //         (reason) => {
            //             console.log('all onRejected()', reason);
            //         }
            //     );

            //常见问题

            /*      const p = new Promise((resolve, reject) => {
                //resolve(1)//promise变为resolved成功状态
                //reject(2)//promise变为rejected失败状态
                // throw new Error('出错了')//抛出异常 ,promise变为rejected失败状态,reason为抛出的error
                throw 3; //抛出异常 promise变为rejected失败状态,reason为抛出的3
            });
            p.then(
                (value) => {},
                (reason) => {
                    console.log('reason', reason);
                }
            ); */

            /* new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve(1); //后改变的状态(同时指定数据),异步执行回调函数
                }, 1000);
            }).then(
                //先指定回调函数,保存当前指定的回调函数
                (value) => {},
                (reason) => {
                    console.log('reason', reason);
                }
            ); */
            //改先后方法1
            /* new Promise((resolve, reject) => {
                resolve(1); //先改变的状态(同时指定数据)
            }).then(
                //后指定回调函数,异步执行回调函数
                (value) => {
                    console.log('value2', value);
                },
                (reason) => {
                    console.log('reason2', reason);
                }
            ); */
            //改先后方法2
            /* const p = new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve(1); //先改变的状态(同时指定数据)
                }, 1000);
            });
            setTimeout(() => {
                p.then(
                    //后指定回调函数,异步执行回调函数
                    (value) => {
                        console.log('value3', value);
                    },
                    (reason) => {
                        console.log('reason3', reason);
                    }
                );
            }, 1100); */
            //4问题
            /*  new Promise((resolve, reject) => {
                resolve(1);
                //reject(2);
            })
                .then(
                    (value) => {
                        console.log('onResolved1()', value);
                        //return 2
                        //return Promise.resolve(3)
                        //return Promise.reject(4)
                        throw 5
                    },
                    (reason) => {
                        console.log('onRecjcted1()', reason);
                    }
                )
                .then(
                    (value) => {
                        console.log('onResolved2()', value);
                    },
                    (reason) => {
                        console.log('onRecjcted2()', reason);
                    }
                ); */

            //5问题  promise 如何串连多个操作任务

            new Promise((resolve, reject) => {
                setTimeout(() => {
                    console.log('执行任务1(异步)');
                    resolve(1);
                }, 1000);
            })
                .then((value) => {
                    console.log('任务1的结果', value);
                    console.log('执行任务2(同步)');
                    //resolve(2);
                    return 2;
                })
                .then((value) => {
                    console.log('任务2的结果', value);
                    return new Promise((resolve, reject) => {
                        //启动异步任务3
                        setTimeout(() => {
                            console.log('执行任务3(异步)');
                            resolve(3);
                        }, 1000);
                    });
                })
                .then((value) => {
                    console.log('任务1的结果', value);
                });
        </script>
    </body>
</html>
